<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml">

	<ui:define name="head">
		
		<script type="text/javascript">
		
		var currentMarker = null;
		 
	    function handlePointClick(event) {
	    	console.log("entro"+document.getElementById('geoForm:lat').value);
	    	if(currentMarker === null) {
	            document.getElementById('geoForm:lat').value = event.latLng.lat();
	            document.getElementById('geoForm:lng').value = event.latLng.lng();
	 
	            currentMarker = new google.maps.Marker({
	                position:new google.maps.LatLng(event.latLng.lat(), event.latLng.lng())
	            });
	 
	            PF('map').addOverlay(currentMarker);
	 
	            PF('dlg').show();
	        }   
	    }
	 
	    function markerAddComplete() {
// 	        var title = document.getElementById('geoForm:title');
// 	        currentMarker.setTitle(title.value);
// 	        title.value = "";
	 
	        currentMarker = null;
	        PF('dlg').hide();
	    }
	 
	    function cancel() {
	        PF('dlg').hide();
	        currentMarker.setMap(null);
	        currentMarker = null;
	 
	        return false;
	    }
        </script>
		<style type="text/css">
</style>
	</ui:define>

	<ui:define name="content">

		<h:form id="geoForm">
			<p:growl id="growl" life="3000" />
			
			<div class="Container100">
				<div class="ContainerIndent">
					<div class="Card ShadowEffect  ">
						<div class="ContainerIndent">
							<h2 class="BigTopic">Búsqueda</h2>

							<div class="Container80 Responsive50">
								<p:panelGrid columns="4" layout="grid"
									style="border:0px !important; background:none;"
									styleClass="FormContent">
									
									<h:outputText value="Usuario: " />
									<p:selectOneMenu id="advanced4" styleClass="width: 100%;"
										value="#{geoBean.user}" converter="userConverter"
										panelStyle="width:180px" var="t" style="width:160px">
										<f:selectItem itemLabel="Seleccione Uno" itemValue="#{null}" />
										<f:selectItems value="#{geoBean.userList}" var="proj"
											itemLabel="#{proj.usrName} #{proj.usrLastname}" itemValue="#{proj}" />
										
																				
										<p:column>
											<h:outputText value="#{t.usrName} #{t.usrLastname}" />
										</p:column>
									</p:selectOneMenu>

									
									<h:outputText value="Fecha: " />
                                    <p:calendar id="button" showOn="button" value="#{geoBean.date}"/>
									
								</p:panelGrid>
							</div>
							<div class="Container20 Responsive50">
								<p:panelGrid columns="2" layout="grid"
									style="border:0px !important; background:none;"
									styleClass="FormContent">
									<p:commandButton value="Buscar" styleClass="PurpleButton"
										actionListener="#{geoBean.search()}" />
									<p:commandButton value="Limpiar" styleClass="PurpleButton"
										actionListener="#{userBean.clean()}" />
									
								</p:panelGrid>
							</div>
						</div>

					</div>
				</div>
			</div>
			
			<div class="Container100">
				<div class="ContainerIndent">
					<div class="Card ShadowEffect  ">
						<div class="ContainerIndent">
							<p:gmap id="gmap" center="-0.180653,-78.467834" zoom="13"
								type="HYBRID" style="width:100%;height:1000px"
								model="#{geoBean.emptyModel}"
								onPointClick="handlePointClick(event);" widgetVar="map">
								<p:ajax event="overlaySelect"
									listener="#{geoBean.onPolylineSelect}" update="growl" />
							</p:gmap>
						</div>

					</div>
				</div>
			</div>


			<p:dialog id="test" widgetVar="dlg" showEffect="fade">

				<h:panelGrid columns="2">

					<h:outputText value="Usuario" />
					<p:selectOneMenu id="advanced" styleClass="width: 100%;"
						value="#{geoBean.geo.user}" converter="userConverter"
						panelStyle="width:180px" var="t" style="width:160px">
						<f:selectItem itemLabel="Seleccione Uno" itemValue="#{null}" />
						<f:selectItems value="#{geoBean.userList}" var="proj"
							itemLabel="#{proj.usrName}" itemValue="#{proj}" />

						<p:column>
							<h:outputText value="#{t.usrName}" />
						</p:column>

						<p:column>
							<h:outputText value="#{t.usrLastname}" />
						</p:column>
					</p:selectOneMenu>
					
					<h:outputText value="Dirección: " />
		 			<p:inputText value="#{geoBean.geo.geoAddress}"  />
							
					
					<f:facet name="footer">
						<p:commandButton value="Add" actionListener="#{geoBean.addMarker}"
							oncomplete="markerAddComplete()" />
						<p:commandButton value="Cancel" onclick="return cancel()" />
					</f:facet>
				</h:panelGrid>
				<h:inputHidden id="lat" value="#{geoBean.lat}" />
				<h:inputHidden id="lng" value="#{geoBean.lng}" />
			</p:dialog>
		</h:form>
	</ui:define>

</ui:composition>